<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banknote Recognition System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .stat-card { background: #f5f5f5; padding: 15px; border-radius: 5px; text-align: center; }
        .btn { background: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé´ –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –±–∞–Ω–∫–Ω–æ—Ç</h1>
        
        <div class="section">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div id="stats" class="stats-grid">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>

        <div class="section">
            <h2>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏</h2>
            <button class="btn" onclick="prepareDataset()">–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞—Ç–∞—Å–µ—Ç</button>
            <button class="btn" onclick="loadImages()">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</button>
        </div>

        <div class="section">
            <h2>üñºÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
            <input type="file" id="fileInput" accept="image/*">
            <button class="btn" onclick="uploadImage()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å</button>
        </div>

        <div class="section">
            <h2>üìã –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±–∞–∑–µ</h2>
            <div id="imagesList"></div>
        </div>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            try {
                const response = await fetch('/recognition-stats');
                const stats = await response.json();
                
                document.getElementById('stats').innerHTML = `
                    <div class="stat-card">
                        <h3>${stats.total_recognition || 0}</h3>
                        <p>–í—Å–µ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–π</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.unique_images || 0}</h3>
                        <p>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</p>
                    </div>
                    <div class="stat-card">
                        <h3>${(stats.avg_confidence || 0).toFixed(3)}</h3>
                        <p>–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</p>
                    </div>
                `;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞
        async function prepareDataset() {
            try {
                const response = await fetch('/prepare-dataset', { method: 'POST' });
                const result = await response.json();
                alert(`–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ ${result.processed_count} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`);
                loadStats();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        async function loadImages() {
            try {
                const response = await fetch('/images');
                const data = await response.json();
                
                let html = '<table border="1" style="width: 100%;"><tr><th>ID</th><th>–§–∞–π–ª</th><th>–°—Ç—Ä–∞–Ω–∞</th><th>–ù–æ–º–∏–Ω–∞–ª</th><th>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</th></tr>';
                
                data.images.forEach(img => {
                    html += `<tr>
                        <td>${img.id}</td>
                        <td>${img.original_name}</td>
                        <td>${img.country || '-'}</td>
                        <td>${img.denomination || '-'}</td>
                        <td>${img.serial_number || '-'}</td>
                    </tr>`;
                });
                
                html += '</table>';
                document.getElementById('imagesList').innerHTML = html;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        async function uploadImage() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                return;
            }

            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                //alert(`–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: ${result.result.serial_number} (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${result.result.confidence.toFixed(3)})`);
                loadStats();
                loadImages();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadImages();
        });
    </script>
</body>
</html>